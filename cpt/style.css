:root {
  --bg: #050807;
  --panel: #07120b;
  --line: #0f3820;
  --neon: #00ff41;
  --alert: #ff0033;
  --tile: min(8.8vw, 62px);
}

* { box-sizing: border-box; }
body {
  margin: 0;
  min-height: 100vh;
  background: radial-gradient(circle at top, #0d1f14 0%, var(--bg) 55%);
  color: var(--neon);
  font-family: "IBM Plex Mono", monospace;
}

.shell {
  width: min(1280px, 96vw);
  margin: 18px auto;
  display: grid;
  grid-template-columns: minmax(620px, 1.8fr) minmax(320px, 1fr);
  gap: 14px;
}
.panel {
  background: linear-gradient(180deg, #08160d, var(--panel));
  border: 1px solid var(--line);
  border-radius: 10px;
  box-shadow: 0 0 0 1px rgba(0, 255, 65, 0.12), 0 12px 28px rgba(0, 0, 0, 0.5);
}
.terminal-header {
  font-size: 12px;
  letter-spacing: 0.1em;
  padding: 10px;
  border-bottom: 1px solid var(--line);
}
.viewport-wrap { padding-bottom: 10px; }

#viewport {
  width: calc(var(--tile) * 10);
  height: calc(var(--tile) * 10);
  margin: 12px auto;
  position: relative;
  overflow: hidden;
  border: 1px solid #104d2a;
  background: #1d5f24;
  transform-origin: center;
}
#tileLayer {
  position: absolute;
  inset: 0;
  display: grid;
  grid-template-columns: repeat(10, 1fr);
  grid-template-rows: repeat(10, 1fr);
}
.tile {
  border: 1px solid rgba(0, 0, 0, 0.12);
  image-rendering: pixelated;
}
.tile.grass {
  background:
    radial-gradient(circle at 26% 35%, rgba(164, 255, 167, 0.22), transparent 40%),
    repeating-linear-gradient(45deg, #1e7428, #1e7428 6px, #1a6b23 6px, #1a6b23 12px);
}
.tile.asphalt {
  background:
    repeating-linear-gradient(-45deg, #33373b, #33373b 6px, #2a2e31 6px, #2a2e31 12px),
    radial-gradient(circle at 60% 55%, rgba(255, 255, 255, 0.08), transparent 45%);
}
.tile.driveway { background: #4d5156; }

.entity { position: absolute; transform: translate(-50%, -50%); z-index: 6; }
.house,
.car,
.van,
.player,
.agent {
  background-repeat: no-repeat;
  background-position: center;
  background-size: contain;
  image-rendering: pixelated;
}

.house {
  width: calc(var(--tile) * 2.2);
  height: calc(var(--tile) * 2);
  background-image: url("./assets/house.svg"), linear-gradient(180deg, #975555, #7e3232);
  border: 0;
  z-index: 5;
}
.car {
  width: calc(var(--tile) * 0.8);
  height: calc(var(--tile) * 1.2);
  background-image: url("./assets/car.svg"), linear-gradient(180deg, #5f6b8e, #202840);
  border: 0;
  z-index: 7;
}
.van {
  width: calc(var(--tile) * 1.3);
  height: calc(var(--tile) * 0.9);
  background-image: url("./assets/van.svg"), linear-gradient(90deg, #c4d3de, #7f99a8);
  border: 0;
  z-index: 8;
}
.player {
  width: calc(var(--tile) * 0.9);
  height: calc(var(--tile) * 0.9);
  background-image: url("./assets/player-front.svg"), radial-gradient(circle, #ffe3c4 0 36%, #6f3232 40% 100%);
  z-index: 10;
}
.player.walking { animation: bob 0.35s infinite alternate; }
@keyframes bob {
  from { transform: translate(-50%, -50%) rotate(-5deg) translateY(1px); }
  to { transform: translate(-50%, -50%) rotate(5deg) translateY(-1px); }
}

.agent {
  width: calc(var(--tile) * 0.75);
  height: calc(var(--tile) * 0.75);
  background-image: url("./assets/agent.svg"), linear-gradient(180deg, #2a53bf, #102f91);
  border: 0;
  z-index: 9;
}
.vision {
  position: absolute;
  width: calc(var(--tile) * 2.8);
  height: calc(var(--tile) * 2.8);
  clip-path: polygon(50% 50%, 0 100%, 100% 100%);
  background: rgba(255, 0, 51, 0.24);
  transform-origin: 50% 50%;
  animation: sweep 3.2s infinite ease-in-out alternate;
  z-index: 4;
  pointer-events: none;
}
@keyframes sweep {
  from { transform: translate(-50%, -50%) rotate(-40deg); }
  to { transform: translate(-50%, -50%) rotate(40deg); }
}

#blueprintOverlay {
  position: absolute;
  border: 2px dashed rgba(91, 173, 255, 0.95);
  background: rgba(67, 133, 255, 0.2);
  z-index: 3;
  pointer-events: none;
}

.dialogue {
  width: calc(var(--tile) * 9.4);
  margin: 0 auto;
  padding: 8px 10px;
  border: 1px solid #1d5f35;
  background: rgba(4, 12, 8, 0.94);
  color: #d8ffe4;
}

.sidebar { padding: 14px; }
h1 { margin: 0 0 10px; font-size: 24px; }
h2 { font-size: 14px; margin: 15px 0 8px; color: #8dffaf; }
.stats p { margin: 6px 0; display: flex; justify-content: space-between; align-items: center; }
.stats .label { display: inline-flex; align-items: center; gap: 6px; }
.alert { color: var(--alert); }

.hud-icon {
  width: 18px;
  height: 18px;
  border-radius: 3px;
  border: 1px solid #1a4d2d;
  background-color: rgba(13, 37, 22, 0.9);
  background-repeat: no-repeat;
  background-position: center;
  background-size: 14px 14px;
  image-rendering: pixelated;
}
.icon-calendar { background-image: url("./assets/icon-calendar.svg"); }
.icon-coins { background-image: url("./assets/icon-coins.svg"); }
.icon-shield { background-image: url("./assets/icon-shield.svg"); }
.icon-search { background-image: url("./assets/icon-search.svg"); }

.meter { height: 12px; border: 1px solid var(--line); margin: 5px 0 8px; }
.meter i { display: block; height: 100%; width: 0%; background: var(--neon); }
.meter i.danger { background: var(--alert); }

.market-item {
  border: 1px solid #1a4d2d;
  background: rgba(4, 18, 8, 0.8);
  padding: 7px;
  margin-bottom: 6px;
}
.market-item button { float: right; }
.btn {
  width: 100%;
  margin-top: 8px;
  background: #0a2a17;
  color: var(--neon);
  border: 1px solid #1c7a40;
  padding: 8px;
  cursor: pointer;
}
.btn.main { background: #15341f; font-weight: 700; }
.log {
  border: 1px solid #184526;
  min-height: 120px;
  max-height: 220px;
  overflow: auto;
  padding: 8px;
  font-size: 12px;
}
.log p { margin: 0 0 6px; }
.log .warn { color: var(--alert); }

.search-pulse { animation: pulse 0.7s 2; }
@keyframes pulse {
  0% { box-shadow: 0 0 0 0 rgba(255, 0, 51, 0.7); }
  100% { box-shadow: 0 0 0 20px rgba(255, 0, 51, 0); }
}
.screen-shake { animation: shake 0.3s linear 2; }
@keyframes shake {
  0% { transform: translateX(0); }
  25% { transform: translateX(-6px); }
  50% { transform: translateX(6px); }
  75% { transform: translateX(-4px); }
  100% { transform: translateX(0); }
}
.zoom-car { animation: zoom 2.2s forwards; }
@keyframes zoom {
  to { transform: scale(2.3); }
}
.gps-dot {
  position: absolute;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #ff001e;
  animation: blink 0.4s infinite;
  z-index: 15;
}
@keyframes blink { 50% { opacity: 0; } }

.ending {
  position: fixed;
  inset: 0;
  background: rgba(2, 8, 4, 0.96);
  color: var(--neon);
  display: grid;
  place-items: center;
  z-index: 50;
}
.ending pre {
  font-size: clamp(14px, 2.2vw, 26px);
  line-height: 1.4;
  border: 1px solid #177e43;
  padding: 20px;
  background: rgba(0, 20, 9, 0.8);
}
.hidden { display: none !important; }
